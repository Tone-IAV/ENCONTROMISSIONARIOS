<!-- EQUIPES E PROJETOS -->
<section id="equipes" class="view">
  <div class="modo-leitura">
    <div class="view-toggle" id="equipesPainelToggle">
      <button type="button" class="active" data-pane="macroPane">Dashboard macro</button>
      <button type="button" data-pane="projetoPane">Projeto selecionado</button>
      <button type="button" data-pane="equipesPane">Equipes e Gantt geral</button>
    </div>

    <div class="acoes-compactas" aria-label="Painel de cadastros de equipes e projetos">
      <button type="button" class="btn-ghost" id="toggleEditorEquipes" aria-expanded="false">Mostrar cadastros (equipes, projetos, tarefas)</button>
      <span class="caption">Oculto por padrão; abra somente quando precisar registrar algo.</span>
    </div>

    <div id="macroPane" class="equipes-pane active">
      <div class="macro-wrap">
        <div class="card" id="macroProjetos"></div>
        <div class="macro-panel" id="macroComplemento"></div>
      </div>
      <div class="gantt-wrapper" id="ganttGeralWrapper">
        <h3>Gantt geral dos projetos</h3>
        <p class="caption">Visualize rapidamente como os projetos se distribuem na linha do tempo.</p>
        <div class="gantt-board" id="ganttGeral"></div>
      </div>
    </div>

    <div id="projetoPane" class="equipes-pane">
      <div class="projeto-hero">
        <div>
          <p class="caption">Painel de projetos</p>
          <h2 id="projetoTitulo">Selecione um projeto</h2>
          <div class="hero-meta">
            <span class="status-badge" id="projetoStatusBadge">Sem status</span>
            <span class="pill" id="projetoPrazoBadge">Prazo não definido</span>
          </div>
        </div>
        <div class="stacked" style="min-width:220px;">
          <label class="caption">Alternar projeto</label>
          <select id="projetoSelect"></select>
          <span class="pill" id="projetoEquipeBadge">Equipe não atribuída</span>
        </div>
      </div>

      <div class="acoes-compactas" aria-label="Ações rápidas de projeto">
        <button type="button" onclick="abrirTarefaModal('self')">+ Tarefa para mim</button>
        <button type="button" onclick="abrirTarefaModal('membro')">+ Tarefa para equipe</button>
        <button type="button" class="btn-ghost" onclick="abrirAnexoModal()">Anexar evidência/nota</button>
        <button type="button" class="btn-ghost" onclick="abrirCustoModal()">Vincular custo</button>
        <span class="caption">Abra somente o que precisa: detalhes e formulários aparecem sob demanda.</span>
      </div>

      <div class="kpi-grid" id="projetoIndicadores"></div>

      <div class="subnav projeto-tabs" id="projetoTabNav">
        <button type="button" class="subtab active" data-projeto-tab="resumo">Visão geral</button>
        <button type="button" class="subtab" data-projeto-tab="tarefas">Tarefas</button>
        <button type="button" class="subtab" data-projeto-tab="equipe">Equipe</button>
        <button type="button" class="subtab" data-projeto-tab="arquivos">Arquivos & Anexos</button>
        <button type="button" class="subtab" data-projeto-tab="financeiro">Financeiro</button>
        <button type="button" class="subtab" data-projeto-tab="cronograma">Cronograma</button>
        <button type="button" class="subtab" data-projeto-tab="kanban">Kanban - status tarefas</button>
      </div>

      <div class="projeto-view active" id="tab-resumo">
        <div class="section-grid" id="resumoGeral"></div>
      </div>

      <div class="projeto-view" id="tab-tarefas">
        <div class="table-group">
          <div class="table-controls">
            <button type="button" class="btn-secondary btn-small" onclick="abrirTarefaModal('membro')">+ Nova tarefa</button>
            <button type="button" class="btn-ghost btn-small" onclick="abrirTarefaModal('self')">+ Para mim</button>
          </div>
          <div class="table-scroll" id="tarefasLista"></div>
        </div>
      </div>

      <div class="projeto-view" id="tab-equipe">
        <div class="section-grid" id="painelEquipe"></div>
      </div>

      <div class="projeto-view" id="tab-arquivos">
        <div class="section-grid" id="painelArquivos"></div>
      </div>

      <div class="projeto-view" id="tab-financeiro">
        <div class="section-grid" id="painelFinanceiro"></div>
      </div>

      <div class="projeto-view" id="tab-cronograma">
        <div class="section-grid" id="painelCronograma"></div>
      </div>

      <div class="projeto-view" id="tab-kanban">
        <div class="kanban-board" id="kanbanBoard"></div>
      </div>
    </div>

    <div id="equipesPane" class="equipes-pane">
      <div class="card" id="equipesTabela"></div>
      <div class="gantt-wrapper">
        <h3>Calendário geral de marcos</h3>
        <p class="caption">Veja todos os marcos e entregas em um único fluxo.</p>
        <div class="timeline" id="marcosGerais"></div>
      </div>
    </div>

    <div id="tarefaOverlay" class="detalhe-overlay hidden">
      <div class="modal-shell">
        <button class="detalhe-fechar" onclick="fecharOverlay('tarefaOverlay')">✕</button>
        <h3>Nova tarefa rápida</h3>
        <p class="caption">Escolha o projeto, selecione uma pessoa já cadastrada e defina prazo e prioridade.</p>
        <form id="formTarefaModal">
          <label>Projeto
            <select id="modalProjeto" name="modalProjeto"></select>
          </label>
          <label>Título da tarefa
            <input name="titulo" type="text" required placeholder="Ex: Solicitar orçamento para refeições">
          </label>
          <div class="field-row">
            <label>Responsável
              <select id="modalResponsavel" name="modalResponsavel" required></select>
            </label>
            <label>Prazo
              <input name="prazo" type="date" lang="pt-BR" required>
            </label>
          </div>
          <div class="field-row">
            <label>Prioridade
              <select name="prioridade">
                <option value="alta">Alta</option>
                <option value="media" selected>Média</option>
                <option value="baixa">Baixa</option>
              </select>
            </label>
            <label>Status inicial
              <select name="status">
                <option value="backlog">A fazer</option>
                <option value="fazendo">Em progresso</option>
                <option value="pronto">Concluído</option>
              </select>
            </label>
          </div>
          <textarea name="detalhes" placeholder="Observações, necessidades ou anexos esperados"></textarea>
          <div class="detalhe-acoes">
            <button type="button" class="btn-cancelar" onclick="fecharOverlay('tarefaOverlay')">Cancelar</button>
            <button type="submit" class="btn-salvar">Salvar tarefa</button>
          </div>
        </form>
      </div>
    </div>

    <div id="anexoOverlay" class="detalhe-overlay hidden">
      <div class="modal-shell">
        <button class="detalhe-fechar" onclick="fecharOverlay('anexoOverlay')">✕</button>
        <h3>Anexar evidência ou nota</h3>
        <p class="caption">Relacione arquivos a um projeto ou tarefa existente.</p>
        <form id="formAnexoModal">
          <label>Projeto
            <select id="modalProjetoAnexo" name="modalProjetoAnexo"></select>
          </label>
          <label>Tarefa (opcional)
            <select id="modalTarefaAnexo" name="modalTarefaAnexo"></select>
          </label>
          <label>Descrição do arquivo
            <input name="descricao" type="text" required placeholder="Ex: Orçamento do fornecedor X">
          </label>
          <label>Upload
            <input type="file" id="modalArquivoAnexo" name="arquivo" accept="image/*,application/pdf,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
          </label>
          <div class="field-row">
            <label>Tipo
              <select name="tipo">
                <option>PDF</option>
                <option>Imagem</option>
                <option>Planilha</option>
                <option>Recibo</option>
              </select>
            </label>
            <label>Tamanho
              <input name="tamanho" type="text" placeholder="1.2 MB">
            </label>
          </div>
          <textarea name="observacao" placeholder="O que este arquivo comprova ou libera?"></textarea>
          <div class="detalhe-acoes">
            <button type="button" class="btn-cancelar" onclick="fecharOverlay('anexoOverlay')">Cancelar</button>
            <button type="submit" class="btn-salvar">Salvar anexo</button>
          </div>
        </form>
      </div>
    </div>

    <div id="custoOverlay" class="detalhe-overlay hidden">
      <div class="modal-shell">
        <button class="detalhe-fechar" onclick="fecharOverlay('custoOverlay')">✕</button>
        <h3>Vincular custo ao plano</h3>
        <p class="caption">Somente abra quando precisar informar um gasto ou estimativa ligada a uma tarefa.</p>
        <form id="formCustoModal">
          <label>Projeto
            <select id="modalProjetoCusto" name="modalProjetoCusto"></select>
          </label>
          <label>Tarefa relacionada (opcional)
            <select id="modalTarefaCusto" name="modalTarefaCusto"></select>
          </label>
          <div class="field-row">
            <label>Categoria
              <input name="categoria" type="text" required placeholder="Ex: Alimentação, Hospedagem">
            </label>
            <label>Valor realizado
              <input name="valor" type="number" min="0" step="0.01" required>
            </label>
          </div>
          <textarea name="justificativa" placeholder="Justifique o gasto ou descreva o plano de ação sem custo."></textarea>
          <div class="detalhe-acoes">
            <button type="button" class="btn-cancelar" onclick="fecharOverlay('custoOverlay')">Cancelar</button>
            <button type="submit" class="btn-salvar">Registrar custo</button>
          </div>
        </form>
      </div>
    </div>

    <div id="detalheTarefaOverlay" class="detalhe-overlay hidden">
      <div class="modal-shell">
        <button class="detalhe-fechar" onclick="fecharOverlay('detalheTarefaOverlay')">✕</button>
        <div id="detalheTarefaConteudo"></div>
      </div>
    </div>
  </div>
  <div class="modo-edicao hidden" id="painelEditorEquipes">
    <h2>Gerenciar Equipes e Projetos</h2>
    <div class="section-actions">
      <button type="button" class="btn-secondary" onclick="toggleFormCard('cardNovaEquipe')">+ Nova equipe</button>
      <button type="button" class="btn-secondary" onclick="toggleFormCard('cardNovoProjeto')">+ Novo projeto</button>
      <button type="button" class="btn-secondary" onclick="toggleFormCard('cardNovaTarefa')">+ Nova tarefa (kanban)</button>
      <span class="caption">Formulários ficam ocultos e só aparecem quando chamados.</span>
    </div>
    <div class="grid-3">
      <div class="card hidden" id="cardNovaEquipe">
        <h3>Nova Equipe</h3>
        <form id="formEquipe">
          <input name="nomeEquipe" type="text" placeholder="Nome da equipe" required>
          <input name="responsavelEquipe" type="text" placeholder="Responsável" required>
          <textarea name="membrosEquipe" placeholder="Membros (separados por vírgula)"></textarea>
          <button type="submit" class="btn-salvar">Salvar Equipe</button>
        </form>
      </div>
      <div class="card hidden" id="cardNovoProjeto">
        <h3>Novo Projeto</h3>
        <form id="formProjeto">
          <input name="nomeProjeto" type="text" placeholder="Nome do projeto" required>

          <label>Equipe responsável
            <select id="projetoEquipe" name="projetoEquipe"></select>
          </label>

          <label>Responsável principal
            <select id="projetoResponsavel" name="projetoResponsavel"></select>
          </label>

          <div class="field-row">
            <label>Data de início
              <input name="inicioProjeto" type="date" required>
            </label>
            <label>Data de término
              <input name="fimProjeto" type="date" required>
            </label>
          </div>

          <label>Status inicial
            <select name="statusProjeto">
              <option value="planejado">Planejado</option>
              <option value="andamento">Em andamento</option>
              <option value="concluido">Concluído</option>
              <option value="atrasado">Atrasado</option>
            </select>
          </label>

          <label>Orçamento previsto
            <input name="orcamentoProjeto" type="number" min="0" step="0.01" placeholder="0,00">
          </label>

          <textarea name="descricaoProjeto" placeholder="Descrição detalhada do projeto"></textarea>

          <label>Imagem de capa
            <input type="file" name="capaProjeto" accept="image/*">
          </label>

          <button type="submit" class="btn-salvar">Salvar Projeto</button>
        </form>
      </div>
      <div class="card hidden" id="cardNovaTarefa">
        <h3>Nova Tarefa (Kanban)</h3>
        <form id="formTarefa">
          <input name="tituloTarefa" type="text" placeholder="Título da tarefa" required>
          <select id="tarefaProjeto" name="tarefaProjeto" required></select>
          <input name="responsavelTarefa" type="text" placeholder="Responsável pela entrega" required>
          <input name="prazoTarefa" type="date" lang="pt-BR" required>
          <select name="prioridadeTarefa">
            <option value="alta">Alta prioridade</option>
            <option value="media" selected>Média prioridade</option>
            <option value="baixa">Baixa prioridade</option>
          </select>
          <input name="etiquetaTarefa" type="text" placeholder="Etiqueta/Categoria (opcional)">
          <select name="statusTarefa">
            <option value="backlog">Backlog</option>
            <option value="fazendo">Fazendo</option>
            <option value="pronto">Pronto</option>
          </select>
          <button type="submit" class="btn-salvar">Adicionar Tarefa</button>
        </form>
      </div>
    </div>
    <div id="equipes-edicao"></div>
  </div>
</section>
